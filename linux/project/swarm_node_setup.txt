netstat -ntulp | grep dockerd

Setup vi color
echo 'syntax off' > .vimrc

alias h='history'
alias la='ls -ltr'
alias lt='ls -trl'
alias l.='ls -lad .*'
alias lz='ls -lSr .*'
alias gs='git status'
alias gd='git diff'
alias src='source ~/.bashrc'
alias d='docker'

Prompt Color:
PS1='${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
	                                        									______

PS1='${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;97m\]\w\[\033[00m\]\$ '

Black-0;30 Red-0;31 Green-0;32 Brown-0;33 Blue-0;34 Magenta-0;35 Cyan-0;36 White-0;37
Replace 0 with 1 to get a light colored version.

Setup ssh
ssh-keygen -t rsa
Copy client pub key to node's authorized_keys

Optional:
sudo hostnamectl set-hostname node-1
adduser mark

Access:
sudo usermod -aG sudo mark   -- mark has sudo privilages 
sudo usermod -aG docker mark

sudo systemctl status docker.service

Install Docker:
https://docs.docker.com/engine/install/ubuntu/
sudo apt-get update
sudo apt-get install ./docker-desktop-amd64.deb
gpg --generate-key
pass init <your_generated_gpg-id_public_key>

d completion bash > ~/.config/bash/completions/docker.bash


Docker Shell autocomplition  https://www.techrepublic.com/article/enable-docker-command-completion/
sudo apt-get install bash-completion -y
sudo curl https://raw.githubusercontent.com/docker/docker-ce/master/components/cli/contrib/completion/bash/docker -o /etc/bash_completion.d/docker.sh

pgAdmin4   https://www.pgadmin.org/   sudo apt install pgadmin4-desktop
+Postrgess: /Users/Shared/semplicita/linux/project/docker-compose.yaml(postrgess/password), pgAdmin --> Server : authserver --> Database: users --> 
Query Tool --> select * from users

+https://www.mongodb.com/docs/compass/current/install/#std-label-download-install
+sudo apt install ./mongodb-compass_1.45.0_amd64.deb

Docker cleanup
d stack rm my app 
docker rm -vf $(docker ps -aq)
docker rmi -f $(docker images -aq)

Firewall:

Swarm Ports
Port 2377 TCP for communication with and between manager nodes
Port 7946 TCP/UDP for overlay network node discovery
Port 4789 UDP (configurable) for overlay network traffic

sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https
sudo ufw allow 2377/tcp
sudo ufw allow 7946/tcp
sudo ufw allow 7946/udp
sudo ufw allow 4789/udp
sudo ufw allow 8025/tcp
sudo ufw allow 27017/tcp
sudo ufw enable
sudo ufw status

To                         Action      From
--                         ------      ----
22/tcp                     ALLOW       Anywhere
80/tcp                     ALLOW       Anywhere
443                        ALLOW       Anywhere
2377/tcp                   ALLOW       Anywhere
7946/tcp                   ALLOW       Anywhere
7946/udp                   ALLOW       Anywhere
4789/udp                   ALLOW       Anywhere
8025/tcp                   ALLOW       Anywhere
22/tcp (v6)                ALLOW       Anywhere (v6)
80/tcp (v6)                ALLOW       Anywhere (v6)
443 (v6)                   ALLOW       Anywhere (v6)
2377/tcp (v6)              ALLOW       Anywhere (v6)
7946/tcp (v6)              ALLOW       Anywhere (v6)
7946/udp (v6)              ALLOW       Anywhere (v6)
4789/udp (v6)              ALLOW       Anywhere (v6)
8025/tcp (v6)              ALLOW       Anywhere (v6)

cd /
sudo mkdir swarm
sudo chown -R  mark:mark swarm/
cd swarm/
mkdir -p caddy_data caddy_config db-data/mongo db-data/postgres

mark@aceri5:~$ docker swarm init  --advertise-addr 192.168.2.202
Swarm initialized: current node (9x9h6ajs887n3nujooli3734i) is now a manager.
To add a worker to this swarm, run the following command:
    docker swarm join --token SWMTKN-1-2la96jh7fvtutg8ugr6xl7cna7vss1ejozmuscy9jlx9rf9icp-dy90vwnvl6yr5nf0q24avxn0m 192.168.2.202:2377
To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.

d info | grep -E '(Swarm|Name|Nodes|Cluster|NodeID|Node Address|Managers)'.*

mark@latitude:~$  docker swarm join --token SWMTKN-1-2la96jh7fvtutg8ugr6xl7cna7vss1ejozmuscy9jlx9rf9icp-dy90vwnvl6yr5nf0q24avxn0m 192.168.2.202:2377
This node joined a swarm as a worker.

Worker:
docker context ls
docker context use default
d swarm leave -f

docker node ls

sudo docker stack deploy -c swarm.prd.yaml myapp

_______________________________________________________________________________________


Digital ocean is very popular and you know, they work very well.
And another popular one is Vultr, which is also relatively cost effective.

DigitalOceane has a really good tutorial on hardening and Ubuntu 20.04 server.
I have a course on Udemy about securing VPNs and it happens to use Ubuntu 20.04 as the version.

Domain: http://lln3nc.ca
VMs: https://cloud.linode.com/linodes 172.105.6.250

Linode
Currently in list view
node-1	Running Nanode 1 GB	172.105.6.250 CA, Toronto

ssh root@172.105.6.250
ssh -t tsizism@lish-ca-central.linode.com node-1
ssh -t mark@lish-ca-central.linode.com node-1
ssh mark@172.105.6.250
hostname
sudo hostnamectl set-hostname node-1

adduser mark
sudo usermod -aG sudo mark   -- mark has sudo privilages 
sudo usermod -aG docker mark

id mark


MailHog: http://swarm.lln3nc.ca:8025/
Mongo:   MongoDB Compass --> Connect using 'trace' connection "mongodb://admin:password@node-1.lln3nc.ca:27017/" --> Database:  trace --> Collection trace

d info | grep -E '(Swarm|Name|Nodes|Cluster|NodeID|Node Address)'.*
__toggle_docker_context_promp